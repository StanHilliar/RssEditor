<div class="" data-ng-controller="EmaileditorController"  ng-init="load()" layout="column" flex>
	<md-content layout="row" flex>
		<div layout="column" flex="40">
			<!-- <ul class="nav nav-tabs">
				<li role="presentation" ng-class="tabs[0].class" ng-show="enableDropZone"><a href="#" ng-click="changeTab(0)">Add</a></li>
				<li role="presentation" ng-class="tabs[1].class"><a href="#" ng-click="changeTab(1)">Edit</a></li>
				<li role="presentation" ng-class="tabs[2].class" ><a href="#" ng-click="changeTab(2)">Send</a></li>
			</ul> -->
			<md-tabs md-selected="leftNavTabIndex" md-dynamic-height="true" md-border-bottom>
				<md-tab ng-disabled="!enableDropZone">
					<md-tab-label >
						Add
					</md-tab-label>
					<md-tab-body>
						<div data-ng-show="enableDropZone">
							<fieldset>
						
							<div class="row">
								<div class="">
									<div class="pickUpArea">
										<div id="sortable" layout="row" layout-wrap layout-fill style="padding-bottom: 32px;" ng-cloak>
											<div class="emailModule md-whiteframe-1dp" md-truncate ng-repeat="module in entity.dropzoneModules" data-module-id="{{module._id}}" flex-sm="45" flex-gt-sm="35" flex-gt-md="25" >
												<div class="thumbnail emailModuleHandle">
													<!-- <img alt="100%x200" data-src="holder.js/100%x50" style="height: 50px; width: 100%; display: block;" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9InllcyI/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMjQyIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDI0MiAyMDAiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiPjwhLS0KU291cmNlIFVSTDogaG9sZGVyLmpzLzEwMCV4MjAwCkNyZWF0ZWQgd2l0aCBIb2xkZXIuanMgMi42LjAuCkxlYXJuIG1vcmUgYXQgaHR0cDovL2hvbGRlcmpzLmNvbQooYykgMjAxMi0yMDE1IEl2YW4gTWFsb3BpbnNreSAtIGh0dHA6Ly9pbXNreS5jbwotLT48ZGVmcz48c3R5bGUgdHlwZT0idGV4dC9jc3MiPjwhW0NEQVRBWyNob2xkZXJfMTVhMTM1NzRiZDIgdGV4dCB7IGZpbGw6I0FBQUFBQTtmb250LXdlaWdodDpib2xkO2ZvbnQtZmFtaWx5OkFyaWFsLCBIZWx2ZXRpY2EsIE9wZW4gU2Fucywgc2Fucy1zZXJpZiwgbW9ub3NwYWNlO2ZvbnQtc2l6ZToxMnB0IH0gXV0+PC9zdHlsZT48L2RlZnM+PGcgaWQ9ImhvbGRlcl8xNWExMzU3NGJkMiI+PHJlY3Qgd2lkdGg9IjI0MiIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNFRUVFRUUiLz48Zz48dGV4dCB4PSI4OS44NTAwMDAzODE0Njk3MyIgeT0iMTA1LjciPjI0MngyMDA8L3RleHQ+PC9nPjwvZz48L3N2Zz4=" data-holder-rendered="true"> -->
													<div class="caption">
														{{module.name}}
													</div>
												</div>	
											</div>
										</div>
										
									</div>
								</div>
							</div>
							<div class="row">
								<div class="col-md-12">
								<h3>recycle bin</h3>
									<div id="trash" class="trashBin">
									</div>
								</div>
							</div>
									
							</fieldset>
						</div>
					</md-tab-body>
				</md-tab>
				<md-tab>
					<md-tab-label>
						Edit
					</md-tab-label>
					<md-tab-body>
						<div>
							<div data-ng-show="!isEmailModuleSelected && isEditMode">
								<md-input-container class="md-block" flex-gt-xs>
									<label for="currentEntryView" class="dark">View</label>
									<md-select ng-model="currentEntry.data._view" ng-model-options="{trackBy: '$value._id'}" name="currentEntryView" ng-change="updateViewforEntry()">
										<md-option ng-repeat="item in currentEntry.views" ng-value="item">
											{{item.name}}
										</md-option>
									</md-select>
								</md-input-container>

								<div data-ng-show="currentEntry.module.type == '1'">
									<md-input-container class="md-block" flex-gt-xs>
										<label for="currentEntryTitle" class="dark">Title</label>
										<input type="text" class="form-control" placeholder="" ng-model="currentEntry.data.title" name="currentEntryTitle">	 
									</md-input-container>

									<md-input-container class="md-block" flex-gt-xs>
										<label for="currentEntryLink" class="dark">Link</label>
										<input type="text" class="form-control" placeholder="" ng-model="currentEntry.data.link" name="currentEntryLink">
									</md-input-container>

									<md-input-container class="md-block" flex-gt-xs>
										<label for="currentEntryImage" class="dark">Image</label>
										<input type="text" class="form-control" placeholder="" ng-model="currentEntry.data.image" name="currentEntryImage">
									</md-input-container>

									<md-input-container class="md-block" flex-gt-xs>
										<label for="currentEntryContent" class="dark">Content</label>
										<textarea  placeholder="Content" rows="4" class="form-control" id="" name="currentEntryContent"  ng-model="currentEntry.data.content" ></textarea>
									</md-input-container>
										<!--
									<label for="currentEntryTitleContentSnippet">ContentSnippet</label>
									<textarea  placeholder="ContentSnippet" rows="4" class="form-control" id="" name="currentEntryTitleContentSnippet"  ng-model="currentEntry.data.contentSnippet" ></textarea>
									<br/>
								
									<div data-ng-repeat="var in entity.modules[currentEntry.moduleId].variables">
										{{var}} 
									</div>-->
								</div>	
							
								<div data-ng-repeat="xmlVar in currentEntry.module.xmlVariables">
									<md-input-container class="md-block" flex-gt-xs>
										<label for="" class="dark">{{xmlVar.label}}</label>
										<input type="text" class="form-control" placeholder="" ng-model="currentEntry.data[xmlVar.name]" name="">	
									</md-input-container>				
								</div>

								<div data-ng-repeat="(key, value) in currentEntry.data.data">
									<md-input-container class="md-block" flex-gt-xs>
										<label for="" class="dark">{{currentEntry.data.variables[key].label}}</label>
										<input type="text" class="form-control" placeholder="" ng-model="currentEntry.data.data[key]" name="">	
									</md-input-container>				
								</div>

								<!--<button type="button" class="btn btn-primary" ng-click="deleteEntry()">Delete</button>-->

								<div class="row">
									<div class="col-xs-12 col-md-12">
										<br/>
										<!-- <div class="btn-group">
											<md-button ng-click="currentEntry.data.state = 1; updateEntryState()" class="md-raised">active</md-button>
											<md-button ng-click="currentEntry.data.state = 2; updateEntryState()" class="md-raised">inActive</md-button>
											<md-button ng-click="currentEntry.data.state = 0; updateEntryState()" class="md-raised">deleted</md-button>
										</div> -->
										<md-radio-group ng-model="currentEntry.data.state" ng-click="updateEntryState()">
												
											<md-radio-button value="1">active</md-radio-button>
											<md-radio-button value="2" class="md-warn"> inActive </md-radio-button>
											<md-radio-button value="0" class="md-warn">deleted</md-radio-button>
									
										</md-radio-group>
										{{currentEntry.data.state}}
									</div>
								</div>
								<br/>
							</div>
							<div data-ng-show="isEmailModuleSelected  && isEditMode">
								<div class="row">
									<div class="col-xs-12 col-md-12">
										<h3>email module options</h3>
										number of elements: {{currentEmailModuleData.numberOfEntries}}
										<button type="button" class="btn btn-default btn-sm" ng-click="addEntry(currentEmailModuleData.id)">
										<span class=" glyphicon glyphicon-plus" aria-hidden="true" ></span> add
										</button>
									</div>
								</div>
								
								<div data-ng-repeat="(key, value) in currentEmailModule.bodyVariables">		
									<label for="" class="dark">{{value.label}}</label>
									<input type="text" class="form-control" placeholder="" ng-model="currentEmailModuleData.bodyData[value.name]" name="">	
								</div>

								<div class="row">
									<div class="col-xs-12 col-md-12">
										<div class="btn-group" ng-show="currentEmailModule.removeable">
											<label class="btn btn-primary" ng-model="currentEmailModuleData.state" uib-btn-radio="1" >active</label>
											<label class="btn btn-primary" ng-model="currentEmailModuleData.state" uib-btn-radio="2" >inActive</label>
											<label class="btn btn-primary" ng-model="currentEmailModuleData.state" uib-btn-radio="0" >deleted</label>
										</div>
										<div class="btn-group" ng-hide="currentEmailModule.removeable">
											<label class="btn btn-primary disabled" popover-animation="true" popover-title="Why is this not working?" uib-popover="This option has been disabled by the admin for this module.">active</label>
											<label class="btn btn-primary disabled">inActive</label>
											<label class="btn btn-primary disabled">deleted</label>
										</div>
									</div>
								</div>
							</div>
						</div>
					</md-tab-body>
				</md-tab>
				<md-tab>
					<md-tab-label>
						Settings
					</md-tab-label>
					<md-tab-body>
						<div ng-disabled="storedEmail.status=='active'">		
							<div layout="column"  layout-padding>
								<md-input-container>
									<label for="EmailNamefield">internal name</label>		     
									<input ng-model="EmailName" name="EmailNamefield">   		
								</md-input-container>
							
								<md-input-container>
									<label for="EmailSegment">segment <!--{{segment}}--></label>
									<md-select ng-model="segment" name="EmailSegment">
										<md-option ng-repeat="segment in entity.segments" value="{{segment.id}}">
											{{segment.name}}
										</md-option>
									</md-select>
								</md-input-container>
							
								<md-input-container  flex-gt-xs>
									<label for="EmailSubjectfield">email subject</label>
									<input type="text" placeholder="Subject" ng-model="EmailSubject" name="EmailSubjectfield">   						
								</md-input-container>
							
								<md-input-container  flex-gt-xs>
									<label for="hiddenPreviewText">hidden preview text</label>
									<textarea type="text" placeholder="enter your hidden preview text here" ng-model="hiddenPreviewText" id="hiddenPreviewText" name="EmailSubject"></textarea>
								</md-input-container>
							</div>
						</div>
					</md-tab-body>
				</md-tab>
				<md-tab ng-disabled="!storedEmail.eloquaEmail">
					<md-tab-label>							
						Test
					</md-tab-label>
					<md-tab-body>
						<div ng-disabled="storedEmail.status=='active'" layout="column" layout-padding>	
							<md-input-container class="md-block">
								<label for="testEmailAddresses" class="dark">email addresses</label>
								<input type="text" class="form-control" placeholder="emails" ng-model="testEmailAddresses" id="testEmailAddresses" name="testEmailAddresses">
							</md-input-container>
							<div flex>	
								<md-button data-ng-hide="testSendingInProgress" class="md-raised md-accent" ng-click="sendTestEmail()"><md-icon class="material-icons md-light md-48">send</md-icon> send Test</md-button>				
								<md-button data-ng-show="testSendingInProgress" class="md-raised md-accent">sending</md-button>
							</div>	
						</div>	
					</md-tab-body>
				</md-tab>
				<md-tab ng-disabled="!storedEmail.eloquaEmail">
					<md-tab-label>
						Send
					</md-tab-label>
					<md-tab-body>
						<div ng-disabled="storedEmail.status=='active'">
							<div layout-gt-xs="row" layout-padding>
								<div class="col-lg-6">
									<label class="control-label" for="scheduleDate">set date and time for sending</label>
								</div>
							</div>
							
							<div layout-gt-xs="row">
								<div layout="column">
									<!-- <div class="input-group">
										<input type="text" class="form-control" uib-datepicker-popup="{{format}}" ng-model="dt" is-open="popup1.opened" min-date="minDate" max-date="maxDate" datepicker-options="dateOptions" date-disabled="disabled(date, mode)" ng-required="true" close-text="Close" name="scheduleDate" placeholder="dd.mm.yyyy"/>
										<span class="input-group-btn">
											<button type="button" class="btn btn-default" ng-click="open1()"><i class="glyphicon glyphicon-calendar"></i></button>
										</span>
									</div> -->
									<md-input-container flex-gt-xs>
										<md-datepicker ng-model="dt" md-placeholder="Enter date" md-open-on-focus md-min-date="minDate" md-max-date="maxDate"></md-datepicker>
									</md-input-container>
									<div layout="row">
										<md-button class="" ng-click="setinXDays(0)">today</md-button>
										<md-button class="" ng-click="setinXDays(1)">tomorrow</md-button>
									</div>
								</div>
								<div>
									<md-input-container class="md-block" flex-gt-xs>
										<input type="time" class="form-control" required="true" ng-model="dt" data-format="hh:mm" name="scheduleTime" placeholder="hh:mm" />
									</md-input-container>
									<div layout="row">
										<md-button class="" ng-click="setTimeinXMinutes(10)">in 10 min</md-button>
										<md-button class="" ng-click="setTimeinXMinutes(30)">in 30 min</md-button>
									</div>
								</div>
							</div><!-- /.row -->
		

							<div class="row">
								<div class="col-md-12">	
									<br/>
									<!--elqEmail: {{storedEmail.eloquaEmail}}<br>
									eloquaCampaign: {{storedEmail.eloquaCampaign}}-->
									<md-button data-ng-show="storedEmail.status =='draft' && storedEmail.eloquaEmail && !scheduleInProgress" class="md-raised md-accent" ng-click="scheduleEmail()"><md-icon class="material-icons md-light md-48">watch_later</md-icon> schedule</md-button>
									<md-button data-ng-show="storedEmail.status =='draft' && storedEmail.eloquaEmail && !scheduleInProgress" class="md-accent" ng-click="sendEmailRightNow()"><md-icon class="material-icons md-light md-48">send</md-icon> send right now</md-button>
							
									<md-button data-ng-show="storedEmail.status =='active' && storedEmail.eloquaEmail && !scheduleInProgres" class="md-warn" ng-click="unscheduleEmail()"><md-icon class="material-icons md-light md-48">alarm_off</md-icon> unschedule</md-button>				
									
									<md-button data-ng-show="scheduleInProgress" class="md-raised md-accent">scheduling</md-button>
								</div>
							</div>
						</div>
					</md-tab-body>
				</md-tab>
			</md-tabs>
			<div layout="row" ng-show="errorMsgs.length > 0">
				<div class="col-sm-8 col-md-8 col-lg-6">
					<div class="alert alert-danger alert-dismissible" role="alert" data-ng-repeat="error in errorMsgs">
						<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<strong>{{error.param}}</strong> {{error.msg}} 
					</div>
				</div>
			</div>
			<div ng-repeat="currentAdData in adData">
				{{$index}}:
					<div ng-repeat="subCurrentadData in currentAdData">
					   &nbsp;-- &nbsp; {{$index}}: {{subCurrentadData}}
				  </div>
			   </div>
		</div>	
		
		<div layout="column" class="" flex>				
			<div flex>	
				<wysiwyg-editor>
					<wysiwyg-edit content="your_variable" api="api"></wysiwyg-edit>
				</wysiwyg-editor>	
			</div>
		</div>
	</md-content>
	<md-progress-linear md-mode="indeterminate" ng-show="loading || loadingNewModule || saveInProgress || scheduleInProgress || testSendingInProgress"></md-progress-linear>
	<md-toolbar md-colors="{'background': 'primary-50'}">
		<div class="md-toolbar-tools ">
			<h3 flex md-truncate>{{EmailName}}</h3>
			<!-- {{EmailName| limitTo: 40 }}{{EmailName.length > 40 ? '...' : ''}} -->
			<h3>status: {{storedEmail.status? storedEmail.status : '---'}}</h3>
					
			&nbsp;&nbsp;&nbsp;&nbsp;
			<md-switch class="md-primary" aria-label="switch Mode" ng-model="isEditMode" ng-change="setMode()">
				<span ng-show="isEditMode">Edit</span><span ng-hide="isEditMode">Preview</span> Mode
			</md-switch>
			&nbsp;&nbsp;		
			<md-button data-ng-hide="saveInProgress" ng-click="saveEmail()" class="md-raised md-primary"><md-icon class="material-icons md-light md-48">save</md-icon> save</md-button>
			<md-button data-ng-show="saveInProgress"  class="md-raised md-primary"><md-icon class="material-icons md-light md-48">save</md-icon> save</md-button>						
		</div>
	</md-toolbar>	
</div>

